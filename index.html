<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1L4SNXQDL8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-1L4SNXQDL8');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Viewport Meta Tag -->
    <title>Coloquial Spanish Translator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> <!-- Bootstrap CSS -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script> <!-- Bootstrap jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script> <!-- Bootstrap Popper -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script> <!-- javascript cookie manager-->
    <style>
        body {
            background-color: #f0f8ff;
            padding: 10px;
            margin: 0;
        }

        h1, h2 {
            color: #003366;
            text-align: center;
            padding: 5px;
        }

        .text-area, .button {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            border: 2px solid #003366;
            border-radius: 5px;
        }

        .button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            padding: 15px;
            font-size: 1rem;
        }

        .button:disabled {
            background-color: grey;
        }

        .button:hover:enabled {
            background-color: #0056b3;
        }

        #outputText {
            height: auto;
            min-height: 100px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h3 style="text-align: center;">Coloquial Spanish Translator</h3>
        <h5 style="text-align: center;">From any language</h5>
        <textarea id="inputText" class="form-control text-area" placeholder="Enter anything...or press 'Translate' to learn a new phrase" rows="4"></textarea>
        <div class="form-group">
            <label for="languageSelect" style="color: #003366;">Select Country:</label>
            <select class="form-control" id="languageSelect">
                <option value="Argentina">Argentina</option>
                <option value="Chile">Chile</option>
                <option value="Colombia">Colombia</option>
                <option value="Guatemala">Guatemala</option>
                <option value="México">México</option>
                <option value="Peru">Peru</option>
                <option value="España">España</option>
            </select>
        </div>
        <button id="translateButton" class="btn btn-primary button">Translate</button>
        <div id="outputText" class="text-area"></div>
        <div style="font-size: smaller; margin-top: 60px;"> <!-- Smaller font size and additional margin -->
            A popup will ask you to provide your OpenAI API key. This key is stored as a cookie in your browser. Generate yours here: 
            <a href="https://platform.openai.com/api-keys">https://platform.openai.com/api-keys</a>.
        </div>
        <div style="font-size: smaller; margin-top: 20px;"> <!-- Smaller font size and additional margin -->
            Estimated cost/translation: $0.01</a>.
        </div>
        <div style="font-size: smaller; margin-top: 20px;"> <!-- Smaller font size -->
            Link to source code: 
            <a href="https://github.com/myles-i/TranslateToArgentineanSpanish">https://github.com/myles-i/TranslateToArgentineanSpanish</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to handle translation
            async function translateText() {
                button = document.getElementById("translateButton");
                button.disabled = true;
                button.innerText = "Processing..."
                var selectedCountry = document.getElementById('languageSelect').value;
                Cookies.set('selectedCountry', selectedCountry, { expires: 3650 }); //save selected country for future sessions
                let systemMessage = 
`
Traducí lo que dice el usuario a una frase en español informal usando argot y coloquialismos de `+ selectedCountry + `. La idea es aprender como un local de `+ selectedCountry + ` lo diría. La traducción NO debería ser literal, y NO debería traducir cada palabrita. Sé lo mas breve e informal posible. Si hay una manera de decirlo que solamente se diria `+ selectedCountry + `, mejor! Solo usá lenguaje que se escucha hoy en día (no antiquado).

Poné en negrilla (usando formato "markdown" asi: **negrilla**) cada uso de una expresión o palabra que sea particular al país. Si hay alguna duda del significado, ponelo en negrilla. Después, explicá el significado de cada frase en negrilla al final. Primero la explicación literal, y después coloquial. Sé breve.

El “¡Che Boludo!” por James Bracken tiene buenos ejemplos para el español informal de Argentina con lunfardo. Para `+ selectedCountry + `, el argot y los coloquialismos pueden ser diferentes, pero esto te da una idea del tono. Para español de Argentina, siempre usá el lunfardo si es posible. Esto lo hace divertido.

Si el usario dice "...###", elegí una frase común cualquiera que sea únicamente de `+ selectedCountry + ` que se podría decir en el día a día. A veces una expresión corta, a veces más larga.

Tené cuidado de seguir el formato de los ejemplos así se puede leer bien en html.

Nunca usés argot o coloquialismos racistas o ofensivos.`

                let examples_txt = 
`
Q::: 'No hay muchas personas asiáticas acá.'

R::: (Español coloquial de Argentina) No hay muchas personas asiáticas acá.


<u> Explicación: </u>

Esta frase no tiene argot ni coloquialismos


Q::: 'can you go to the pharmacy to get me some cough medicine?'

R::: (Español coloquial de Argentina) ¿Podés ir a la farmacia a comprarme un jarabe para la tos?


<u> Explicación: </u>

Esta frase no tiene argot ni coloquialismos


Q::: 'Can I borrow 2 pesos?'

R::: (Español coloquial de Argentina) Me **hacés la gamba** con **dos lucas**?


<u> Explicación: </u>
- **hacés la gamba**: Literalmente "haces la pierna". En exte contexto, significa pedir un favor.
- **dos lucas**:  “dos mil pesos”

Q::: 'What a freakin disaster...

This man always messes everything up!'

R::: (Español coloquial de Argentina) Que **quilombo**...

este tipo siempre se manda **mocos**


<u> Explicación: </u>
- **quilombo**: desorden o situación caótica.
- **mocos**: literalment significa mucosa nasal, pero en este contexto significa errores o metidas de pata.

Q::: 'fue muy facil!'

R::: (Español coloquial de Argentina) fue una **pavada**! 


<u> Explicación: </u>
- **pavada**: algo que no tiene importancia o que es muy fácil de realizar.

Q::: 'Would you mind paying for my bus ticket?'

R::: (Español coloquial de Argentina) ¿Me prestás el **bondi**?


<u> Explicación: </u>
- **bondi**: un colectivo o autobús. En este este contexto "me prestas el bondi" es una manera coloquial de pedir que alguien te deje usar su tarjeta de transporte público.

Q::: '...3489391'

R::: (Español coloquial de Argentina) Me compré una **remera** re **canchera** en la feria de San Telmo, re **piola** el diseño.


<u> Explicación: </u>
- **remera**:  camiseta o playera
- **canchera**: se refiere a algo con estilo o a la moda
- **piola**: se usa para describir algo que es inteligente, astuto o simplemente genial


Q::: 'You're such an idiot!'

R::: (Español coloquial de Argentina) Que **boludo**!


<u> Explicación: </u>
- **boludo**:  En Argentina, "boludo" significa tonto o estupido. Entre amigos, puede signifcar algo como "amigo". Depende del contexto.


Q::: 'You're such an idiot!'

R::: (Español coloquial de España) Que **gilipollas**!


<u> Explicación: </u>
- **gilipollas**:  En Espana, "gilipollas" significa necio o estúpido


`; 
                // if there is no input text, prompt chatgpt to simply output an interesting phrase
                let inputText = document.getElementById('inputText').value;
                let temperature = 0.3 // by default, lower temperature to get highest probability output
                if (!inputText) {
                    var date = new Date();
                    var millisecondsSinceEpoch = date.getTime();
                    inputText = "..." + millisecondsSinceEpoch.toString(); // give it todays ms time as a "random" number
                    temperature = 1; // for a random phrase, maximize the temperature to get more variable output
                }

                // get openAI Key from cookie
                let apiKey = Cookies.get('openAIKey');
                if (!apiKey) {
                    apiKey = prompt("Please enter your OpenAI API key:", "");
                    if (apiKey) {
                        Cookies.set('openAIKey', apiKey, { expires: 3650 }); //expires in 10 years
                    } else {
                        alert("API key is required to proceed.");
                        return;
                    }
                }
                apiKey = Cookies.get('openAIKey');


                // build up the chatgpt prompt from the examples, and user message, and send to OpenAI
                content = examples_txt + "Q::: '" + inputText + "'\n\nR::: (Español coloquial de "+ selectedCountry + ") ";
                console.log(systemMessage)
                console.log(content)
                try {
                    let response = await fetch("https://api.openai.com/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer " + apiKey
                        },
                        body: JSON.stringify({
                            model: "gpt-4",
                            temperature: temperature,
                            messages: [
                                {
                                    role: "system",
                                    content: systemMessage
                                },
                                {
                                    role: "user",
                                    content: content
                                }
                            ]
                        })
                    });
                    
                    console.log(response)
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

                let data = await response.json()
                // console.log(data)
                rawMsg = data.choices[0].message.content;
                // console.log(rawMsg)
                markedMsg = marked.parse(rawMsg)
                console.log(markedMsg)
                document.getElementById('outputText').innerHTML = markedMsg;
                } catch (error) {
                    console.error('Error:', error);
                    alert("Failed to fetch translation.");
                }

                // reenable button once done
                button.disabled = false; 
                button.innerText = "Translate!"
            }

            // set selected country based on saved cookie
            let defaultCountry = Cookies.get('selectedCountry');
            if (defaultCountry){
                document.getElementById('languageSelect').value = Cookies.get('selectedCountry');
            }

            // add event handler for button press
            document.getElementById('translateButton').addEventListener('click', translateText);

            // make enter press "translate", and shift+enter add a newling
            document.getElementById('inputText').addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    // Prevent default Enter behavior (newline)
                    event.preventDefault();
                    // Trigger button click
                    document.getElementById('translateButton').click();
                }
            });

        });
    </script>
</body>
</html>
