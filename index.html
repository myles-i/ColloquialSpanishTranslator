<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Viewport Meta Tag -->
    <title>Argentinean Translator - with lunfardo (slang)!</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> <!-- Bootstrap CSS -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script> <!-- Bootstrap jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script> <!-- Bootstrap Popper -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> <!-- Bootstrap JS -->
    <style>
        body {
            background-color: #f0f8ff;
            padding: 10px;
            margin: 0;
        }

        h1, h2 {
            color: #003366;
            text-align: center;
            padding: 5px;
        }

        .text-area, .button {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            border: 2px solid #003366;
            border-radius: 5px;
        }

        .button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            padding: 15px;
            font-size: 1rem;
        }

        .button:disabled {
            background-color: grey;
        }

        .button:hover:enabled {
            background-color: #0056b3;
        }

        #outputText {
            height: auto;
            min-height: 100px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 style="text-align: center;">Translate anything to Argentinean Spanish</h2>
        <h4 style="text-align: center;">From any language, including Spanish</h4>
        <textarea id="inputText" class="form-control text-area" placeholder="Enter any text...or just press Go to learn a new phrase" rows="4"></textarea>
        <button id="translateButton" class="btn btn-primary button">Go</button>
        <div id="outputText" class="text-area"></div>
        <div style="font-size: smaller; margin-top: 60px;"> <!-- Smaller font size and additional margin -->
            A popup will ask you to provide your OpenAI API key. This key is stored as a cookie in your browser. Generate yours here: 
            <a href="https://platform.openai.com/api-keys">https://platform.openai.com/api-keys</a>.
        </div>
        <div style="font-size: smaller; margin-top: 20px;"> <!-- Smaller font size and additional margin -->
            Estimated cost/translation: $0.01</a>.
        </div>
        <div style="font-size: smaller; margin-top: 20px;"> <!-- Smaller font size -->
            Link to source code: 
            <a href="https://github.com/myles-i/TranslateToArgentineanSpanish">https://github.com/myles-i/TranslateToArgentineanSpanish</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to get cookie by name
            function getCookie(name) {
                let nameEQ = name + "=";
                let ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }

            // Function to save cookie
            function setCookie(name, value, days) {
                let expires = '';
                if (days) {
                    let date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = '; expires=' + date.toUTCString();
                }
                document.cookie = name + '=' + (value || '') + expires + '; path=/';
            }
            // Function to handle translation
            async function translateText() {
                button = document.getElementById("translateButton");
                button.disabled = true;

                let systemMessage = 
`
Traduci lo que dice el usario al español informal de Argentina con lunfardo. 

Usa lunfardo cuando sea posible, pero solo si se usa hoy en dia en Argentina (no antiquado). El “¡Che Boludo!” Por James Bracken tiene buenos ejemplos.

Cada cosa que sa lunfardo, o una frase/palabra que sea unicamente argentino (no comun en otros paises), ponelo en negrilla usando formato "markdown". Despues, explica el significado de caca frase en negrillo al final. Primero la explicacion literal, y despues colloquial. Sea breve.

Si el usario dice "...###", elegi una frase commun cualquiera que sean unicamente argentina (por ejemplo, que use lunfardo) que se podria decir en el dia diario. A veces una expresion corta, a veces mas larga.

Tene cuidado de seguir el formato de los ejemplos asi se puede leer bien en html.

Nunca uses lunfardismo racista o ofensivo.`

                let examples_txt = 
`
Q::: No hay muchas personas asiaticas aca.

R::: No hay muchas personas asiaticas aca.


<u> Explicación: </u>
No se usa lunfardo o argentinadas en esta frase.


Q::: can you go to the pharmacy to get me some cough medicine?

R::: ¿Podés ir a la farmacia a comprarme un jarabe para la tos?


<u> Explicación: </u>
No se usa lunfardo o argentinadas en esta frase.


Q::: Can I borrow 2 pesos? 

R::: Me **hacés la gamba** con **dos lucas**?


<u> Explicación: </u>
- **hacés la gamba**: Literalmente "haces la pierna". En exte context, significan pedir un favor.
- **dos lucas**:  “dos mil pesos”

Q::: what a freakin disaster. This man always messes everything up!

R::: Que **quilombo**, este tipo siempre se manda **mocos**


<u> Explicación: </u>
- **quilombo**: desorden o situación caótica.
- **mocos**: literalment significa mucosa nasal, pero en este contexto significa errores o metidas de pata.

Q::: fue muy facil!

R::: fue una **pavada**! 


<u> Explicación: </u>
- **pavada**: algo que no tiene importancia o que es muy fácil de realizar.

Q::: Would you mind paying for my bus ticket?

R::: ¿Me prestás el **bondi**?


<u> Explicación: </u>
- **bondi**: un colectivo o autobús. En este este contexto "me prestas el bondi" es una manera coloquial de pedir que alguien te deje usar su tarjeta de transporte público.

Q::: ...3489391

R::: Me compré una **remera** re **canchera** en la feria de San Telmo, re **piola** el diseño.


<u> Explicación: </u>
- **remera**:  camiseta o playera
- **canchera**: se refiere a algo con estilo o a la moda
- **piola**: se usa para describir algo que es inteligente, astuto o simplemente genial


`;

                let inputText = document.getElementById('inputText').value;
                let temperature = 0.3
                if (!inputText) {
                    var date = new Date();
                    var millisecondsSinceEpoch = date.getTime();
                    inputText = "..." + millisecondsSinceEpoch.toString();
                    temperature = 1;
                }
                console.log(inputText);
                let apiKey = getCookie('openAIKey');
                if (!apiKey) {
                    apiKey = prompt("Please enter your OpenAI API key:", "");
                    if (apiKey) {
                        setCookie('openAIKey', apiKey, 30); // Save for 30 days
                    } else {
                        alert("API key is required to proceed.");
                        return;
                    }
                }
                apiKey = getCookie('openAIKey');

                content = examples_txt + "Q::: " + inputText + "\n\nR::: ";
                console.log(content)
                try {
                    let response = await fetch("https://api.openai.com/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": "Bearer " + apiKey
                        },
                        body: JSON.stringify({
                            model: "gpt-4",
                            temperature: temperature,
                            messages: [
                                {
                                    role: "system",
                                    content: systemMessage
                                },
                                {
                                    role: "user",
                                    content: content
                                }
                            ]
                        })
                    });
                    
                    console.log(response)
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

                let data = await response.json()
                console.log(data)
                rawMsg = data.choices[0].message.content;
                console.log(rawMsg)
                markedMsg = marked.parse(rawMsg)
                console.log(markedMsg)
                document.getElementById('outputText').innerHTML = markedMsg;
                } catch (error) {
                    console.error('Error:', error);
                    alert("Failed to fetch translation.");
                }

                button.disabled = false; // reenable once done
            }

            document.getElementById('translateButton').addEventListener('click', translateText);

        });
    </script>
</body>
</html>
